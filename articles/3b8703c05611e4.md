---
title: "ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—ã®ãŸã‚ã®Playwrightã®ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®æ´»ç”¨"
emoji: "ğŸ­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["playwright", "typescript", "test", "metrics"]
published: true
---

## ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€Playwright ã®ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‹ã‚‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã™ã‚‹ã€‚

## Playwright ã®ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½

[Playwright ã®ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½](https://playwright.dev/docs/test-reporters)ã«ã¯ã€[ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼](https://playwright.dev/docs/test-reporters#custom-reporters)ãŒã‚ã‚‹ã€‚ã“ã®ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã¯ã€[ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼](https://playwright.dev/docs/test-reporters#built-in-reporters)ã®ä»–ã«ã€ç‹¬è‡ªã«å®Ÿè£…ã—ãŸãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆçµæœã‚’ãƒ¬ãƒãƒ¼ãƒˆã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

## ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã®å®Ÿè£…

### ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…

ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã¯ã€[`Reporter`](https://playwright.dev/docs/api/class-reporter)ã‚¯ãƒ©ã‚¹ã‚’æ‹¡å¼µã—ãŸã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹ã€‚

```typescript:src/custom-reporter/index.ts
class CustomReporter implements Reporter {
    // implement custom reporter
}

export default CustomReporter;
```

ã“ã®ã‚¯ãƒ©ã‚¹ã§ã¯ã€ä¸»ã«ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å¿…è¦ãªå€¤ã‚’ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

- [`onEnd(fullResult: FullResult): void`](https://playwright.dev/docs/api/class-reporter#reporter-on-end): ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµ‚äº†æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
- [`onTestEnd(test: Test, result: TestResult): void`](https://playwright.dev/docs/api/class-reporter#reporter-on-test-end): ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œçµ‚äº†æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹

ã“ã®ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€`playwright.config.ts` ã§ `reporter` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã€‚

```typescript:playwright.config.ts
export default defineConfig({
  reporter: [
    [
      "./src/custom-reporter/index.ts"
    ],
  ]
})
```

### ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³å®šç¾©

ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒãƒ¼ã‚¿ãƒ¼ã®ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
ä¾‹ãˆã°ã€å‡ºåŠ›ã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«åã®æŒ‡å®šãªã©ã§ç”¨ã„ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```typescript:src/custom-reporter/index.ts
class CustomReporter implements Reporter {
  constructor(options: {filename: string} = {}) {
    this.filename = options.filename ?? "report.json";
  }
}
```

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã¯ã€`playwright.config.ts` ã§ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã€‚

```typescript:playwright.config.ts
export default defineConfig({
  reporter: [
      // ã‚¿ãƒ—ãƒ«ã®2ç•ªç›®ã®è¦ç´ ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹
    [
      "./src/custom-reporter/index.ts",
      {
        filename: "custom-report.json"
      }
    ],
  ]
})
```

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹

ã‚ˆãåˆ©ç”¨ã™ã‚‹ã¨æ€ã‚ã‚Œã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ä»¥ä¸‹ã«ç¤ºã™ã€‚

### `onEnd` ãƒ¡ã‚½ãƒƒãƒ‰ã§å–å¾—ã§ãã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹æ™‚åˆ»: `FullResult.startTime: Date`
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ: `FullResult.status: 'passed' | 'failed' | 'timedout' | 'interrupted'`
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ (ãƒŸãƒªç§’å˜ä½): `FullResult.duration: number`

### `onTestEnd` ãƒ¡ã‚½ãƒƒãƒ‰ã§å–å¾—ã§ãã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œçµæœ: [`TestCase.outcome`](https://playwright.dev/docs/api/class-testcase#test-case-outcome)
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œæ™‚é–“ (ãƒŸãƒªç§’å˜ä½): [`TestResult.duration`](https://playwright.dev/docs/api/class-testresult#test-result-duration)

### å®Ÿè£…ä¾‹

ä»¥ä¸‹ã«JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šè¨˜ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å‡ºåŠ›ã™ã‚‹ä¾‹ã‚’ç¤ºã™ã€‚

```typescript:src/custom-reporter/index.ts
import {
  TestCase,
  TestResult,
  Reporter,
  FullResult,
} from "@playwright/test/reporter";

type ResultOfTestCase = {
  id: string;
  outcome:   "skipped" | "expected" | "unexpected" | "flaky";
  durationInMs: number;
}

type ResultOfTestSuite = {
  startedAt: number;
  durationInMs: number;
  status: "passed"|"failed"|"timedout""interrupted"|"unknown";
  results: ResultOfTestCase[],
}


class CustomReporter implements Reporter {
  results: ResultOfTestCase[] = [];
  private filename: string;
  constructor(options: {filename: string} = {}) {
    this.filename = options.filename ?? "report.json";
  }

  onTestEnd(testCase: TestCase, testResult: TestResult): void {
    const result: ResultOfTestCase = {
      id: testCase.id,
      outcome: testCase.outcome(),
      durationInMs: testResult.duration,
    };
    this.results.push(result);
  }

  onEnd(fullResult: FullResult) {
    const result: ResultOfTestSuite = {
      startedAt: fullResult.startTime.getTime(),
      durationInMs: fullResult.duration,
      status: fullResult.status,
      results: this.results,
    };
    fs.writeFileSync(
      this.filename,
      JSON.stringify(report, null, 2),
    );
  }
}
```

<!-- qiita article id: 1f995abc639035a49ac6 -->
