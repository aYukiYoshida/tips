---
title: "Windowsãƒã‚·ãƒ³ã‚’JNLPæ–¹å¼ã§Jenkinsã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è¿½åŠ ã™ã‚‹"
emoji: "ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Jenkins"]
published: false
---

## ã¯ã˜ã‚ã«

Jenkinsã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ([Using Jenkins agents](https://www.jenkins.io/doc/book/using/using-agents/))ã«Windowsãƒã‚·ãƒ³ã‚’JNLPæ–¹å¼ã§è¿½åŠ ã™ã‚‹æ–¹æ³•ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ãªã‹ã£ãŸãŸã‚ã€æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

## ç’°å¢ƒ

- Jenkins: version 2.516.1

## å‰æ

- Jenkinsã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«<http://jenkins-hostname:8080/>ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚‚ã®ã¨ã™ã‚‹ã€‚

## æ‰‹é †

### Jenkinsç®¡ç†ç”»é¢ã§ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¿½åŠ 

1. Jenkinsã®ç®¡ç†ç”»é¢<http://jenkins-hostname:8080/manage/computer>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€ŒNew Nodesã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚
1. ã€Œãƒãƒ¼ãƒ‰åã€ã®ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ä»»æ„ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåã‚’å…¥åŠ›ã—(e.g., `windows-agent`)ã€ã€ŒPermanent Agentã€ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¦ã€ŒCreateã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚ã€Œãƒãƒ¼ãƒ‰è¨­å®šã€ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
1. ã€Œãƒªãƒ¢ãƒ¼ãƒˆFSãƒ«ãƒ¼ãƒˆã€ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒã‚·ãƒ³ä¸Šã®Jenkinsç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ã€‚(e.g., `C:\Users\agent-machine-username\jenkins`)
1. ã€Œèµ·å‹•æ–¹æ³•ã€ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒLaunch agent by connecting it to the controllerã€ã‚’é¸æŠã™ã‚‹ã€‚
1. ã€ŒSaveã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚ä½œæˆã—ãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è©³ç´°ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

### Windowsãƒã‚·ãƒ³ã«Javaã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒã‚·ãƒ³ã¨ãªã‚‹Windowsãƒã‚·ãƒ³ã§ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿæ–½ã™ã‚‹ã€‚

1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§Javaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã€‚Versionæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯JavaãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€æ‰‹é †2ä»¥é™ã‚’å®Ÿæ–½ã™ã‚‹ã€‚

    ```powershell
    java -version
    ```

1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

    ```powershell
    winget install -e --id Microsoft.OpenJDK.21 --source winget
    ```

1. å†åº¦Javaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã€‚Versionæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã€‚

    ```powershell
    java -version
    ```

    ```powershell
    openjdk version "21.0.8" 2025-07-15 LTS
    OpenJDK Runtime Environment Microsoft-11933218 (build 21.0.8+9-LTS)
    OpenJDK 64-Bit Server VM Microsoft-11933218 (build 21.0.8+9-LTS, mixed mode, sharing)
    ```

### Windowsãƒã‚·ãƒ³ã‹ã‚‰ã®æ¥ç¶šç¢ºèª

1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§`agent.jar`ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚

    ```powershell
    cd C:\Users\agent-machine-username\jenkins
    curl.exe -sO http://jenkins-hostname:8080/jnlpJars/agent.jar
    ```

1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒã‚·ãƒ³ã‹ã‚‰Jenkinsã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¸æ¥ç¶šã™ã‚‹ã€‚

    ```powershell
    cd C:\Users\agent-machine-username\jenkins
    java -jar agent.jar -url http://jenkins-hostname:8080/ -secret YourSecretLetters -name "trial-node" -webSocket -workDir "C:\Users\agent-machine-username\jenkins"
    ```

1. <http://jenkins-hostname:8080/computer/your-windows-agent-name/>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ãŒã€ŒAgent is connected.ã€ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

### Windows Serviceã¨ã—ã¦ã®ç™»éŒ²

ã“ã“ã¾ã§ã®æ‰‹é †ã§ã¯ã€Windowsãƒã‚·ãƒ³ã®PowerShellä¸Šã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã—ã¦ã„ã‚‹ãŸã‚ã€PowerShellã‚’é–‰ã˜ã‚‹ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚‚åœæ­¢ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’Windows Serviceã¨ã—ã¦ç™»éŒ²ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

1. <https://github.com/winsw/winsw/releases/latest>ã‹ã‚‰Windows Service Wrapperã®å®Ÿè¡Œå½¢å¼ã‚’Windowsãƒã‚·ãƒ³ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åˆã‚ã›ã¦ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚ä»¥ä¸‹ã®æ‰‹é †ã§ã¯`WinSW-x64.exe`ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‚ã®ã¨ã—ã¦è¨˜è¿°ã™ã‚‹ã€‚
1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ`WinSW-x64.exe`ã‚’`C:\Users\agent-machine-username\jenkins\jenkins-agent.exe`ã«ãƒªãƒãƒ¼ãƒ ã—ã¦é…ç½®ã™ã‚‹ã€‚
1. ä»¥ä¸‹ã®XMLã‚’è¨˜è¿°ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«`jenkins-agent.xml`ã‚’`C:\Users\agent-machine-username\jenkins`ã«é…ç½®ã™ã‚‹ã€‚æ³¨æ„ç‚¹ã¨ã—ã¦ã€XMLãƒ•ã‚¡ã‚¤ãƒ«åã®æ‹¡å¼µå­ä»¥å¤–ã‚’ãƒªãƒãƒ¼ãƒ ã—ãŸå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ã«ã—ã€`.xml`ã¨`.exe`ã®2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

    ```xml
    <service>
      <!-- ID of the service. It should be unique across the Windows system-->
      <id>jenkins-agent</id>
      <!-- Display name of the service -->
      <name>Jenkins Agent</name>
      <!-- Service description -->
      <description>Jenkins agent service for this Windows machine</description>

      <!-- Path to the executable, which should be started -->
      <executable>"C:\Program Files\Microsoft\jdk-21.0.8.9-hotspot\bin\java.exe"</executable>
      <arguments>-jar "C:\Users\agent-machine-username\jenkins\agent.jar" -url http://jenkins-hostname:8080/ -secret YourSecretLetters -name "y01-0693941" -webSocket -workDir "C:\Users\agent-machine-username\jenkins"</arguments>
      <log mode="roll"></log>
    </service>
    ```

1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Window Serviceã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

    ```powershell
    cd C:\Users\agent-machine-username\jenkins
    .\jenkins-agent.exe install
    ```

1. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Windows Serviceã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã€‚

    ```powershell
    cd C:\Users\agent-machine-username\jenkins
    .\jenkins-agent.exe start
    ```

1. <http://jenkins-hostname:8080/computer/your-windows-agent-name/>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çŠ¶æ…‹ãŒã€ŒAgent is connected.ã€ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

## ãŠã‚ã‚Šã«

Windowsãƒã‚·ãƒ³ã‚’JNLPæ–¹å¼ã§Jenkinsã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è¿½åŠ ã™ã‚‹æ‰‹é †ã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚SSHæ–¹å¼ã§ã®æ¥ç¶šã‚’ç¢ºç«‹ã™ã‚‹ã®ãŒé›£ã—ã„å ´åˆãªã©ã«å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
