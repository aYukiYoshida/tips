---
title: "QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚‹ï¼ˆãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ç·¨ï¼‰"
emoji: "ğŸ§ª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "typescript", "vitest", "testing"]
published: false
---

## ã¯ã˜ã‚ã«

Reactãªã©ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºçµŒé¨“ã‚¼ãƒ­ã®QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚‹ã‚·ãƒªãƒ¼ã‚ºã§ã™ã€‚

èƒŒæ™¯ã¨ã—ã¦ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«å¯¾ã—ã¦ã€ã€Œãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã ã•ã„ã€ã¨ã‚ˆããŠé¡˜ã„ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã—ã‹ã—ã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰ã€Œãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã®ã§æ›¸ãæ–¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€ã¨è¿”ç­”ã•ã‚Œã‚‹ã¨ã€ãã‚Œã«ç­”ãˆã‚‰ã‚Œã‚‹ã‚¹ã‚­ãƒ«ãŒãªã„ã®ã§ã€è‡ªåˆ†ãªã‚Šã«ç°¡å˜ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã¨ãã‚Œã‚’å¯¾è±¡ã¨ã—ãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

æœ¬æ›¸ã§ã¯ã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã¨ã¯

æœ¬ç¯€ã¯ã€[xUnit Test Patternsã®Test Doubleãƒ‘ã‚¿ãƒ¼ãƒ³](https://goyoki.hatenablog.com/entry/20120301/1330608789)ã‚’å¼•ç”¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

### é–“æ¥å…¥åŠ›

ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«ã€ã¾ãšã¯é–“æ¥å…¥åŠ›ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

ã€Œé–“æ¥å…¥åŠ›ã€ã¨ã¯ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯è¦‹ãˆãªã„ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¸ã®å…¥åŠ›ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¨ãªã‚‹`funcUnderTest`ã®ä¸­ã§ã€`anyExternalFunc`ã®æˆ»ã‚Šå€¤ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã®`anyExternalFunc`ã®æˆ»ã‚Šå€¤ã®ã‚ˆã†ã«ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯ç›´æ¥è¦‹ãˆãªã„ãŒã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å…¥åŠ›ãŒé–“æ¥å…¥åŠ›ã§ã™ã€‚

```javascript
/**
 * ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°
 */
function funcUnderTest() {
  // ä½•ã‹ã®å‡¦ç†
  const input = anyExternalFunc();  // é–“æ¥å…¥åŠ›
  // ä½•ã‹ã®å‡¦ç†
}

describe('funcUnderTest', () => {
  it('should do something', () => {
    expect(funcUnderTest()).toBe('expectedValue');
  });
});
```

ãªãŠã€é–“æ¥å…¥åŠ›ã«ã¯ã€ä¾‹ãˆã°ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒä¾å­˜ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®ä¾‹å¤–ç™ºç”Ÿã‚‚å«ã¿ã¾ã™ã€‚

### ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–

ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¸ã®é–“æ¥å…¥åŠ›ã‚’æ“ä½œã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ã§ã™ã€‚
ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒä¾å­˜ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç½®ãæ›ãˆã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹é–“æ¥å…¥åŠ›ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚‹

ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–“æ¥å…¥åŠ›ã‚’åˆ¶å¾¡ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã‚’ä½¿ã£ã¦ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚

### ãƒ†ã‚¹ãƒˆå¯¾è±¡

ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªReactã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯(`userFetchImage`)ã§ã™ã€‚
ã“ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ãŒä¾å­˜ã—ã¦ã„ã‚‹`Api.getImage`é–¢æ•°ã¯ã€å¤–éƒ¨ã®WebAPIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã—ã¦ã€ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã§ã™ã€‚ã“ã®å¤–éƒ¨ä¾å­˜ã¨ãªã‚‹`Api.getImage`ã‚’ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‹ã‚‰åˆ‡ã‚Šé›¢ã™ãŸã‚ã«ã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã«ç½®ãæ›ãˆã¾ã™ã€‚

```typescript
import {useState, useEffect} from "react";
import {ImageResponse} from "@/lib/types";
import Api from "@/lib/api";

const useFetchImage = (apiKey: string | null) => {
  const [image, setImage] = useState<ImageResponse>();
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    const fetchImage = async () => {
      setLoading(true);
      try {
        const imageResponse = await Api.getImage(apiKey);
        setImage(imageResponse);
      } catch (err) {
        setError(err as Error);
      } finally {
        setLoading(false);
      }
    };

    fetchImage();
  }, [apiKey]);

  return {image, loading, error};
};
```

### ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯Vitestã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`vi.mock`é–¢æ•°ã‚’ä½¿ã£ã¦ã€`@/lib/api`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®`getImage`é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã«ç½®ãæ›ãˆã¾ã™ã€‚

```typescript
import {renderHook, waitFor} from "@testing-library/react";
import {describe, afterEach, it, vi} from "vitest";
import Hooks from "@/lib/hooks";

describe("Hooks.useFetchImage", () => {
  describe("ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒæˆåŠŸã—ãŸå ´åˆ", () => {
    it("ç”»åƒã®æƒ…å ±ãŒè¿”ã‚‹", async ({expect}) => {
      // ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã®å®šç¾©
      vi.mock("@/lib/api", () => {
        return {
          default: {
            // getImageã®æˆ»ã‚Šå€¤ã‚’å›ºå®šã®å€¤ã«ã™ã‚‹
            getImage: vi.fn().mockResolvedValue({
              copyright: "copyright",
              date: "2025-02-26",
              explanation: "explanation",
              hdurl:
                "https://apod.nasa.gov/apod/image/2502/ClusterRing_Euclid_2665.jpg",
              media_type: "image",
              service_version: "v1",
              title: "Einstein Ring Surrounds Nearby Galaxy Center",
              url: "https://apod.nasa.gov/apod/image/2502/ClusterRing_Euclid_960.jpg",
            }),
          },
        };
      });

      const {result} = renderHook(() =>
        Hooks.useFetchImage("SPECIFIED_KEY")
      );

      // éåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’å¾…ã¤
      await waitFor(() => {
        expect(result.current.image).not.toBeNull();
      });

      expect(result.current.image).toEqual({
        copyright: "copyright",
        date: "2025-02-26",
        explanation: "explanation",
        hdurl:
          "https://apod.nasa.gov/apod/image/2502/ClusterRing_Euclid_2665.jpg",
        media_type: "image",
        service_version: "v1",
        title: "Einstein Ring Surrounds Nearby Galaxy Center",
        url: "https://apod.nasa.gov/apod/image/2502/ClusterRing_Euclid_960.jpg",
      });
      expect(result.current.loading).toBe(false);
      expect(result.current.error).toBeNull();
    });
  });
});
```

## ãŠã‚ã‚Šã«

ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã‚’ä½¿ã£ã¦ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–“æ¥å…¥åŠ›ã‚’åˆ¶å¾¡ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚
Web APIã«ä¾å­˜ã™ã‚‹Reactã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹éš›ã«ã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¿ãƒ–ã‚’ä½¿ã†ã“ã¨ã§ã€å¤–éƒ¨ä¾å­˜ã‚’åˆ‡ã‚Šé›¢ã—ã¦ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã®æ±ºå®šæ€§ãŒå‘ä¸Šã—ã€ãƒ†ã‚¹ãƒˆã®ä¿¡é ¼æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
