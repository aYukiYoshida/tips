---
title: "pytest ã§ Allure ã‚’ä½¿ã£ã¦ AAA ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›¸ãã‚„ã™ãã™ã‚‹"
emoji: "ğŸ¥’"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["pytest", "allure", "test"]
published: false
---

## ã¯ã˜ã‚ã«

[pytest](https://docs.pytest.org/en/stable/) ãŠã‚ˆã³ [Allure](https://allurereport.org/) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚„åŸºæœ¬çš„ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯ã€æœ¬è¨˜äº‹ã«ã¯è¨˜è¼‰ã—ã¾ã›ã‚“ã€‚

## Arrange-Act-Assert ã‚¹ã‚¿ã‚¤ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ããŸã„

Arrange-Act-Assert (AAA) ã‚¹ã‚¿ã‚¤ãƒ«ã¯ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ã‚„ã™ãã€ç†è§£ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®ä¸€èˆ¬çš„ãªãƒ†ã‚¹ãƒˆã®è¨˜è¿°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã®ã‚ˆã†ã«ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã«`# Arrange: add items to shopping cart`ãªã©ã¨ã€Œã“ã®éƒ¨åˆ†ã§æº–å‚™ã—ã¦ã¾ã™ã‚ˆã€ã¨ã‚³ãƒ¡ãƒ³ãƒˆã§è¡¨ç¾ã—ãŸã‚Šã—ã¾ã™ã€‚æ›¸ã‹ãªã„ã‚ˆã‚Šã¯ã€æ›¸ã„ãŸæ–¹ãŒè‰¯ã„ã‘ã©ã€ã‚ˆã‚Šã€Œã“ã“ã‹ã‚‰ã“ã“ã¾ã§ãŒæº–å‚™ã€ãªã©ãŒã‚ã‹ã‚Šã‚„ã™ãæ›¸ããŸã„ã§ã™ã—ã€ã¾ãŸã€ã›ã£ã‹ãæ›¸ããªã‚‰ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€æ™‚ä»¥å¤–ã«ã‚‚åˆ©ç›ŠãŒã‚ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

```python
def test_addition():
    # Arrange: define variables
    a = 1
    b = 2

    # Act
    result = a + b

    # Assert
    assert result == 3
```

## Allure ã®å°å…¥

ãã“ã§å°å…¥ã—ãŸã®ãŒã€Allure ãŒæä¾›ã™ã‚‹ [Test steps](https://allurereport.org/docs/steps/) ã¨ã„ã†æ©Ÿèƒ½ã§ã™ã€‚æœ¬æ¥ã€æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒãƒƒã‚¯ã®å®¹æ˜“æ€§ã¨ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã®å¯èª­æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒæœŸå¾…ã§ãã¾ã™ã€‚
ä»¥ä¸‹ã®ä¾‹ã¯ã€Allure ã® Test steps ã‚’ä½¿ã£ã¦ã€AAA ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ãŸã‚‚ã®ã§ã™ã€‚

```python
import allure

def test_addition():
    with allure.step("Arrange: define variables"):
        a = 1
        b = 2

    with allure.step("Act: calculate the sum of a and b"):
        result = a + b

    with allure.step("Assert: check if the result is correct"):
        assert result == 3
```

ã“ã“ã§ã€[`allure.step`](https://allurereport.org/docs/pytest-reference/#test-steps) ã‚’ç”¨ã„ã¦ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å„ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†å‰²ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã®å„éƒ¨åˆ†ãŒæ˜ç¢ºã«ãªã‚Šã€ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã§ã‚‚å„ã‚¹ãƒ†ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆã®æµã‚Œã‚’è¦–è¦šçš„ã«æŠŠæ¡ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

ä¸€æ–¹ã§ã€`allure.step` ã‚’ä½¿ã£ã¦ã€`with allure.step("Arrange: ..."):`ã®ã‚ˆã†ã«é€ä¸€è¨˜è¿°ã™ã‚‹ã®ã¯ã€é¢å€’ã§ã™ã€‚ãã“ã§ã€ã“ã®`allure.step`ã®APIã«å°‘ã—æ‰‹ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€AAA ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‚„ã™ãã•ã›ã¾ã™ã€‚

## `allure.step` ã®æ‹¡å¼µ

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`allure.step` ã‚’æ‹¡å¼µã—ã¦ã€AAA ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã‚„ã™ãã—ã¾ã™ã€‚

```python:aaa.py
from contextlib import contextmanager

import allure


@contextmanager
def arrange(description: str):
    with allure.step(f"Arrange: {description}"):
        yield


@contextmanager
def act(description: str):
    with allure.step(f"Act: {description}"):
        yield


@contextmanager
def assertion(description: str):
    with allure.step(f"Assert: {description}"):
        yield
```

[`@contextlib.contextmanager`](https://docs.python.org/ja/3.13/library/contextlib.html#contextlib.contextmanager)ã‚’ä½¿ã†ã“ã¨ã§ã€`allure.step`ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`with arrange("add items to shopping cart"):`ã®ã‚ˆã†ã«ã€AAA ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```python
from .aaa import arrange, act, assertion

def test_addition():
    with arrange("define variables"):
        a = 1
        b = 2
    with act("calculate the sum of a and b"):
        result = a + b
    with assertion("check if the result is correct"):
        assert result == 3
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚ˆã‚Šã™ã£ãã‚Šã¨æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã¡ãªã¿ã«ã€`allure.step` ã®æ‹¡å¼µã¨ã—ã¦ã€Given-When-Then ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆGherkinã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ã§ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`allure.step` ã®æ‹¡å¼µã‚’è¡Œã„ã¾ã™ã€‚

```python:gherkin.py
from contextlib import contextmanager

import allure

@contextmanager
def given(description: str):
    with allure.step(f"Given: {description}"):
        yield

@contextmanager
def when(description: str):
    with allure.step(f"When: {description}"):
        yield

@contextmanager
def then(description: str):
    with allure.step(f"Then: {description}"):
        yield
```

## ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã¸ã®åŠ¹æœ

Allure ã«ã‚ˆã‚Šå‡ºåŠ›ã•ã‚Œã‚‹ãƒ¬ãƒãƒ¼ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![screenshot ot report](/images/7b37f74971b784/allure-report.png =500x)

ãªãŠã€ä»–ã®Allureã®APIã‚’ä½¿ã†ã“ã¨ã§ã€ã‚ˆã‚Šãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›ã™ã‚‹æƒ…å ±ã‚’å¢—ã‚„ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
[Improving readability of your test reports](https://allurereport.org/docs/gettingstarted-readability/)[ã‚„Improving navigation in your test report](https://allurereport.org/docs/gettingstarted-navigation/)ã‚’å‚è€ƒã«ã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚

## ãŠã‚ã‚Šã«

Allure ã® Test steps ã‚’ä½¿ã†ã“ã¨ã§ã€AAA ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ã‚ˆã‚Šæ›¸ãã‚„ã™ãã™ã‚‹æ–¹æ³•ã®ç´¹ä»‹ã§ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ›¸ãã‚„ã™ã•ã¨èª­ã¿ã‚„ã™ã•ã‚’ç¢ºä¿ã—ã¤ã¤ã€ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚‚ã‚ˆã‚Šç†è§£ã—ã‚„ã™ãã§ãã¾ã™ã€‚
