---
title: "Playwright ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆ - ã‚¤ãƒ™ãƒ³ãƒˆç·¨"
emoji: "ğŸ­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["playwright", "typescript", "test", "testing", "web"]
published: true
---

## ã¯ã˜ã‚ã«

ã‚ˆãã‚ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã«ã¤ã„ã¦ã€Playwrightã§ã©ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã‹ã‚’ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«ç´¹ä»‹ã—ã¾ã™ã€‚

## æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã

`BrowserContext` ã‚¯ãƒ©ã‚¹ã® [`waitForEvent("page")`](https://playwright.dev/docs/api/class-browsercontext#browser-context-wait-for-event) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```typescript
import { test, Page } from "@playwright/test";

test("æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã", async ({ context, page }) => {
  const newTabPromise: Promise<Page> = context.waitForEvent("page");
  // æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ãæ“ä½œ
  await page.getByRole('button', {name: "æ–°ã—ã„ãƒšãƒ¼ã‚¸"}).click();
  const newTab: Page = await newTabPromise;
  await newTab.waitForLoadState("domcontentloaded");
  // æ–°ã—ã„ã‚¿ãƒ–ã§ã®æ“ä½œ

});
```

## ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã

`Page` ã‚¯ãƒ©ã‚¹ã® [`waitForEvent("dialog")`](https://playwright.dev/docs/api/class-page#page-wait-for-event) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```typescript
import { test } from "@playwright/test";

test("ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã", async ({ page }) => {
  // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ãæ“ä½œ
  await page.getByRole("button", { name: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ" }).click();
  page.on("dialog", async (dialog) => {
    await dialog.accept();
  });
  // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãŸã“ã¨ã‚’ç¢ºèª
});
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

`Page` ã‚¯ãƒ©ã‚¹ã® [`waitForEvent("download")`](https://playwright.dev/docs/api/class-page#page-wait-for-event) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```typescript
import fs from "fs";
import { Download } from "playwright";
import { test, expect } from "@playwright/test";

test("ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰", async ({ page }) => {
  const downloadPromise: Promise<Download> = page.waitForEvent("download");
  // ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ“ä½œ
  await page.getByRole("button", { name: "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" }).click();
  const download: Download = await downloadPromise;
  const filePath: string = "downloaded.txt";
  await download.saveAs(filePath);
  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
  expect(fs.existsSync(filePath)).toBeTruthy();
});
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

`Page` ã‚¯ãƒ©ã‚¹ã® [`waitForEvent("filechooser")`](https://playwright.dev/docs/api/class-page#page-wait-for-event) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```typescript
import fs from "fs";
import { FileChooser } from "playwright";
import { test, expect } from "@playwright/test";

test("ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰", async ({ page }) => {
  const fileChooserPromise: Promise<FileChooser> = page.waitForEvent("filechooser");
  await page.getByRole("button", { name: "ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ" }).click();
  const fileChooser: FileChooser = await fileChooserPromise;
  const filePath: string = "toUpload.txt";
  await fileChooser.setFiles(filePath);
  await page.getByRole("button", { name: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰" }).click();
  // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ãŸã“ã¨ã‚’ç¢ºèª
});
```

## ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¿å­˜

å‚è€ƒ: [Authentication - Playwright docs](https://playwright.dev/docs/auth)

```typescript
import { test as setup, expect } from '@playwright/test';

const sessionFile = '.session/user.json';

setup('ãƒ­ã‚°ã‚¤ãƒ³', async ({ page }) => {
  // Perform authentication steps. Replace these actions with your own.
  await page.goto('/login');
  await page.getByLabel('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå').fill('username');
  await page.getByLabel('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰').fill('password');
  await page.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' }).click();
  await page.waitForURL('/home');
  await expect(page.getByRole('heading', { name: 'Welcome to HOME' })).toBeVisible();

  // End of authentication steps.

  await page.context().storageState({ path: authFile });
});
```

## Fixture ã® override

ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«ã‚ˆã£ã¦ Fixture ã®å€¤ã‚’å¤‰æ›´ã—ãŸã„å ´åˆ `test.use` ã‚’ `test.describe` ã®ä¸­ã§ä½¿ç”¨ã™ã‚‹ã€‚

```typescript
type MyFixtures = {
  environment: string;
  username: string;
  password: string;
};

import { test as base } from "@playwright/test";
const test = base.extend<MyFixtures>({
  environment: async ({}, use) => {
    const env = "dev";
    await use(env);
  },
});

test.describe("Login as user", {} =>
  test.describe("As Taro", {} =>
    test.use({
        username: "Taro",
        password: "passwordOfTaro",
    })
    test("login", async ({ page, username, password }) => {
      await page.goto("/login");
      await page.getByLabel("ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå").fill(username);
      await page.getByLabel("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰").fill(password);
      await page.getByRole("button", { name: "ãƒ­ã‚°ã‚¤ãƒ³" }).click();
      await page.waitForURL("/home");
      await expect(
        page.getByRole("heading", { name: "Welcome to HOME" })
      ).toBeVisible();
    })
  );

  test.describe("As John", {} =>
    test.use({
      username: "John",
      password: "passwordOfJohn",
    })
    test("login", async ({ page, username, password }) => {
      await page.goto("/login");
      await page.getByLabel("ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå").fill(username);
      await page.getByLabel("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰").fill(password);
      await page.getByRole("button", { name: "ãƒ­ã‚°ã‚¤ãƒ³" }).click();
      await page.waitForURL("/home");
      await expect(
        page.getByRole("heading", { name: "Welcome to HOME" })
      ).toBeVisible();
    })
  );
);
```

<!-- qiita article id: fab53e0b579d3f18c5ef -->
