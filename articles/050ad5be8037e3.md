---
title: "Appiumç’°å¢ƒæ§‹ç¯‰ï¼ˆAndroidç·¨ï¼‰"
emoji: "ğŸ“±"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Appium", "Android", "test"]
published: true
---

## ã¯ã˜ã‚ã«

æœ¬æ–‡æ›¸ã¯ã€ã€ŒAppiumã§å®Ÿæ©Ÿã®Androidç«¯æœ«ã«æ¥ç¶šã—ã€Androidã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ã¾ã§ã®ç’°å¢ƒæ§‹ç¯‰æ‰‹é †ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚

## ç’°å¢ƒ

æœ¬æ–‡æ›¸ã¯ã€ä»¥ä¸‹ã®ç’°å¢ƒã§å®Ÿéš›ã«æ§‹ç¯‰ã«ã—ãŸæ‰‹é †ã«åŸºã¥ãè¨˜è¼‰ã—ãŸã€‚

- macOS 13.6.7
- Zsh 5.9

ã¾ãŸã€æœ¬æ–‡æ›¸ã®æ‰‹é †ã§ã¯ã€ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãŠã‚ˆã³ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

- [Homebrew](https://brew.sh/ja/) 4.3.0
- [mise](https://mise.jdx.dev/) 2024.5.18 macos-arm64 (2024-05-19)

## æ§‹ç¯‰æ‰‹é †

### Node.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«[ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶](https://appium.io/docs/en/latest/quickstart/requirements/)ã¨ã—ã¦Node.jsãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
mise install node@18.17.1
```

### Appiumã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦Appiumã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
npm i appium
```

### Appium doctorã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[@appium/doctor](https://github.com/appium/appium/tree/master/packages/doctor)ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Appiumã®ç’°å¢ƒãŒæ­£ã—ãæ§‹ç¯‰ã§ãã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã§ãã‚‹ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
npm i -D @appium/doctor
```

### Appium Inspectorã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[Appium Inspector](https://github.com/appium/appium-inspector)ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
brew install --cask appium-inspector
```

### Android Studioã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

UiAutomator2ã®[å¿…è¦è¦ä»¶](https://github.com/appium/appium-uiautomator2-driver?tab=readme-ov-file#requirements)ã«ã¯[Android SDK Platform tools](https://developer.android.com/tools/releases/platform-tools?hl=ja)ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚[Android Studio](https://developer.android.com/studio)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°ã€ã“ã®è¦ä»¶ã‚’æº€ãŸã›ã‚‹ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€Android Studioã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
brew install --cask android-studio
```

`ANDROID_HOME`ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã€`$HOME/.zprofile`ã«ä»¥ä¸‹ã‚’è¨˜è¿°ã™ã‚‹ã€‚

```shell
if [ -d $HOME/Library/Android/sdk ]; then
    export ANDROID_HOME=$HOME/Library/Android/sdk
    export PATH="$ANDROID_HOME/platform-tools:$ANDROID_HOME/tools:$PATH"
fi
```

### Android SDK Command-line Toolsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Android Studioã‚’èµ·å‹•ã—ã€ä»¥ä¸‹ã®æ‰‹é †ã§Android SDK Command-line Toolsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

1. Settings ã‚’é–‹ã
2. ã‚µã‚¤ãƒ‰ãƒšã‚¤ãƒ³ã® `Languages & Frameworks > Android SDK` ã‚’é¸æŠã™ã‚‹
3. `SDK Tools` ã‚¿ãƒ–ã‚’é¸æŠã™ã‚‹
4. `Android SDK Command-line Tools (latest)` ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
5. `OK` ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹

![Android Studio Setting](/images/050ad5be8037e3/android-studio-settings.png =500x)

### OpenJDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
mise plugins install java https://github.com/halcyon/asdf-java.git
mise install java@openjdk-22.0.1
```

### Appium doctorã®å®Ÿè¡Œ

ä»¥ä¸‹ã«Appium doctorã®å®Ÿè¡Œçµæœã‚’ç¤ºã™ã€‚`Diagnostic for necessary dependencies completed, no fix needed.`ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å¿…è¦ãªä¾å­˜é–¢ä¿‚ã¯å•é¡Œãªãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã€‚

```shell
% npx appium-doctor --android
info AppiumDoctor Appium Doctor v.2.0.36
WARN AppiumDoctor This package is deprecated since the Appium server version 2.4.0 and will be removed in the future.
WARN AppiumDoctor Use doctor checks (if any exist) integrated into your installed driver or plugin by running `appium driver doctor <driver_name>` or `appium plugin doctor <plugin_name>`.
info AppiumDoctor ### Diagnostic for necessary dependencies starting ###
info AppiumDoctor  âœ” APPIUM_HOME is /Users/yuki.yoshida/Works/appium-android
info AppiumDoctor  âœ” The Node.js binary was found at: /Users/yuki.yoshida/.local/share/mise/installs/node/18.17.1/bin/node
info AppiumDoctor  âœ” Node version is 18.17.1
info AppiumDoctor  âœ” ANDROID_HOME is set to: /Users/yuki.yoshida/Library/Android/sdk
info AppiumDoctor  âœ” JAVA_HOME is set to: /Users/yuki.yoshida/.local/share/mise/installs/java/openjdk-22.0.1
info AppiumDoctor    Checking adb, emulator, apkanalyzer
info AppiumDoctor      'adb' is in /Users/yuki.yoshida/Library/Android/sdk/platform-tools/adb
info AppiumDoctor      'emulator' is in /Users/yuki.yoshida/Library/Android/sdk/emulator/emulator
info AppiumDoctor      'apkanalyzer' is in /Users/yuki.yoshida/Library/Android/sdk/cmdline-tools/latest/bin/apkanalyzer
info AppiumDoctor  âœ” adb, emulator, apkanalyzer exist: /Users/yuki.yoshida/Library/Android/sdk
info AppiumDoctor  âœ” 'bin' subfolder exists under '/Users/yuki.yoshida/.local/share/mise/installs/java/openjdk-22.0.1'
info AppiumDoctor ### Diagnostic for necessary dependencies completed, no fix needed. ###
info AppiumDoctor
info AppiumDoctor ### Diagnostic for optional dependencies starting ###
info AppiumDoctor  âœ” ffmpeg is installed at: /opt/homebrew/bin/ffmpeg. ffmpeg version 7.0 Copyright (c) 2000-2024 the FFmpeg developers
WARN AppiumDoctor  âœ– mjpeg-consumer cannot be found.
WARN AppiumDoctor  âœ– bundletool.jar cannot be found
WARN AppiumDoctor  âœ– gst-launch-1.0 and/or gst-inspect-1.0 cannot be found
info AppiumDoctor ### Diagnostic for optional dependencies completed, 3 fixes possible. ###
info AppiumDoctor
info AppiumDoctor ### Optional Manual Fixes ###
info AppiumDoctor The configuration can install optionally. Please do the following manually:
WARN AppiumDoctor  âœ mjpeg-consumer module is required to use MJPEG-over-HTTP features. Please install it with 'npm i -g mjpeg-consumer'.
WARN AppiumDoctor  âœ bundletool.jar is used to handle Android App Bundle. Please read http://appium.io/docs/en/writing-running-appium/android/android-appbundle/ to install it
WARN AppiumDoctor  âœ gst-launch-1.0 and gst-inspect-1.0 are used to stream the screen of the device under test. Please read https://appium.io/docs/en/writing-running-appium/android/android-screen-streaming/ to install them and for more details
info AppiumDoctor
info AppiumDoctor ###
info AppiumDoctor
info AppiumDoctor Bye! Run appium-doctor again when all manual fixes have been applied!
info AppiumDoctor
```

### UiAutomator2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
npx appium driver install uiautomator2
```

`appium driver doctor`ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€`0 required fixes needed`è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å¿…è¦ãªä¾å­˜é–¢ä¿‚ã¯å•é¡Œãªãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã€‚

```shell
% npx appium driver doctor uiautomator2
Running 7 doctor checks for the "uiautomator2" driver
info Doctor ### Starting doctor diagnostics  ###
info Doctor  âœ” ANDROID_HOME is set to: /Users/yuki.yoshida/Library/Android/sdk
info Doctor    Checking adb, emulator, apkanalyzer
info Doctor      'adb' exists in /Users/yuki.yoshida/Library/Android/sdk/platform-tools/adb
info Doctor      'emulator' exists in /Users/yuki.yoshida/Library/Android/sdk/emulator/emulator
info Doctor      'apkanalyzer' exists in /Users/yuki.yoshida/Library/Android/sdk/cmdline-tools/latest/bin/apkanalyzer
info Doctor  âœ” adb, emulator, apkanalyzer exist in '/Users/yuki.yoshida/Library/Android/sdk'
info Doctor  âœ” JAVA_HOME is set to: /Users/yuki.yoshida/.local/share/mise/installs/java/openjdk-22.0.1
info Doctor  âœ” 'bin/java' exists under '/Users/yuki.yoshida/.local/share/mise/installs/java/openjdk-22.0.1'
WARN Doctor  âœ– bundletool.jar cannot be found
WARN Doctor  âœ– ffmpeg cannot be found
WARN Doctor  âœ– gst-launch-1.0 and/or gst-inspect-1.0 cannot be found
info Doctor ### Diagnostic completed, 0 required fixes needed, 3 optional fixes possible. ###
info Doctor
info Doctor ### Optional Manual Fixes ###
info Doctor To fix these optional issues, please do the following manually:
WARN Doctor  âœ bundletool.jar is used to handle Android App bundles. Please download the binary from https://github.com/google/bundletool/releases/ and store it to any folder listed in the PATH environment variable. Folders that are currently present in PATH: /Users/yuki.yoshida/Works/qa/linkit/mobile_testing/node_modules/.bin:/Users/yuki.yoshida/Works/qa/linkit/mobile_testing/node_modules/.bin:/Users/yuki.yoshida/Works/qa/linkit/node_modules/.bin:/Users/yuki.yoshida/Works/qa/node_modules/.bin:/Users/yuki.yoshida/Works/node_modules/.bin:/Users/yuki.yoshida/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/yuki.yoshida/.local/share/mise/installs/node/18.17.1/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/yuki.yoshida/.local/share/mise/installs/node/18.17.1/bin:/Users/yuki.yoshida/.local/share/mise/installs/java/openjdk-22.0.1/bin:/Users/yuki.yoshida/.local/share/mise/installs/python/3.11.9/bin:/Users/yuki.yoshida/.rd/bin:/Users/yuki.yoshida/Library/Android/sdk/platform-tools:/Users/yuki.yoshida/Library/Android/sdk/tools:/opt/homebrew/opt/openjdk/bin:/opt/homebrew/opt/icu4c/bin:/opt/homebrew/opt/icu4c/sbin:/opt/homebrew/sbin:/opt/homebrew/opt/openssl/bin:/opt/homebrew/opt/curl/bin:/opt/homebrew/opt/gnu-getopt/bin:/opt/homebrew/opt/grep/libexec/gnubin:/opt/homebrew/opt/gnu-tar/libexec/gnubin:/opt/homebrew/opt/gawk/libexec/gnubin:/opt/homebrew/opt/gnu-sed/libexec/gnubin:/opt/homebrew/opt/findutils/libexec/gnubin:/opt/homebrew/opt/coreutils/libexec/gnubin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/Library/Apple/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/yuki.yoshida/.local/share/mise/shims
WARN Doctor  âœ ffmpeg is used to capture screen recordings from the device under test. Please read https://www.ffmpeg.org/download.html.
WARN Doctor  âœ gst-launch-1.0 and gst-inspect-1.0 are used to stream the screen of the device under test. Please read https://gstreamer.freedesktop.org/documentation/installing/index.html?gi-language=c.
info Doctor
info Doctor Bye! All issues have been fixed!
info Doctor
```

## å®Ÿæ©Ÿã¨ã®æ¥ç¶šç¢ºèª

### ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ç”¨æ„

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§[appium/android-apidemos](https://github.com/appium/android-apidemos)ã‚’cloneã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚ãƒ“ãƒ«ãƒ‰ã—ãŸapkãƒ•ã‚¡ã‚¤ãƒ«ã¯`apks/ApiDemos-debug.apk`ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹ã€‚

```shell
git clone git@github.com:appium/android-apidemos.git
npm install
```

### æ¥ç¶šç¢ºèª

1. Androidç«¯æœ«ã§é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚
1. Androidç«¯æœ«ã¨PCã‚’USBã‚±ãƒ¼ãƒ–ãƒ«ã§æ¥ç¶šã™ã‚‹ã€‚Androidç«¯æœ«ã§USBãƒ‡ãƒãƒƒã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‚
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®apkãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ã€‚
1. Appium Serverã‚’èµ·å‹•ã™ã‚‹ã€‚

    ```shell
    npx appium
    ```

1. Appium Inspectorã‚’èµ·å‹•ã™ã‚‹ã€‚
1. Appium Inspectorã§ã®ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šè¨­å®šã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã€‚ã“ã“ã§ã¯Appiumã‚µãƒ¼ãƒãƒ¼ã®URLãŒ`http://127.0.0.1:4723/`ã§ã‚ã‚‹å ´åˆã®è¨­å®šã‚’ç¤ºã™ã€‚
   - Remote Host: `127.0.0.1`
   - Remote Port: `4723`
   - Remote Path: `/`
1. Appium Inspectorã§ã€capabilitesã®è¨­å®šã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã€‚

    ```JSON
    {
      "platformName": "Android",
      "appium:platformVersion": <Androidç«¯æœ«ã®OSãƒãƒ¼ã‚¸ãƒ§ãƒ³>,
      "appium:deviceName": <Androidç«¯æœ«ã®ç«¯æœ«å>,
      "appium:automationName": "UIAutomator2",
      "appium:udid": <Androidç«¯æœ«ã®UUID>,
      "appium:app": "ApiDemos-debug.apk"
    }
    ```

1. Appium Inspectorã®ã€`Start Session`ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚Appium Inspectorã®ç”»é¢ã§ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æ¥ç¶šæˆåŠŸã§ã‚ã‚‹ã€‚

![Appium Inspector](/images/050ad5be8037e3/appium-inspector.png =500x)

<!-- qiita article id: 40fb07635bda734aa09f -->
